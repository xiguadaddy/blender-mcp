# BlenderMCP 材质修复指南

## 问题描述

在BlenderMCP项目中，我们发现在渲染国际象棋棋盘和棋子时，黑白棋子颜色相同或差异不明显。经过分析，确定了以下可能的原因：

1. **材质设置不完整**：`set_material`函数只设置了基础颜色，没有调整其他影响视觉效果的参数。
2. **对象合并后材质丢失**：在`join_objects`操作后，材质可能未正确保留或应用。
3. **材质节点设置问题**：节点材质的创建和链接可能存在问题，导致颜色无法正确显示。
4. **颜色对比度不足**：白色和黑色棋子的颜色值可能区分度不够。

## 修复方案

### 1. 更新set_material函数

我们提供了一个改进版的`set_material`函数，主要包含以下改进：

- 清理现有节点以避免冲突
- 显式创建和连接Principled BSDF节点和输出节点
- 为黑白棋子设置不同的金属感、粗糙度和镜面反射值，增强视觉差异
- 在应用材质前清除对象的所有现有材质
- 强制更新视图层以确保材质应用生效

### 2. 增强材质视觉对比

- **白色棋子**：设置较低的金属感(0.1)，较低的粗糙度(0.2)，较高的镜面反射(0.8)
- **黑色棋子**：设置较高的金属感(0.7)，中等粗糙度(0.4)，中等镜面反射(0.5)

### 3. 使用更极端的颜色值

- **白色棋子**：使用更亮的白色 [0.95, 0.95, 0.95]
- **黑色棋子**：使用更暗的黑色 [0.02, 0.02, 0.02]

## 如何应用修复

### 方法1：直接替换set_material函数

1. 备份原始`addon.py`文件
2. 将`addon_material_fix.py`中的`set_material`函数复制到`addon.py`中替换原始函数

### 方法2：运行测试脚本验证修复

我们提供了一个测试脚本`demos/test_material_fix.py`，用于验证材质修复是否有效：

1. 启动Blender和BlenderMCP服务器
2. 运行测试脚本：`python demos/test_material_fix.py`
3. 检查渲染结果，验证黑白物体是否具有明显的颜色差异

## 材质处理的最佳实践

1. **总是设置完整的材质属性**：除了基础颜色外，还要适当设置金属感、粗糙度和镜面反射等属性。
2. **合并对象后验证材质**：使用`get_object_info`检查合并后的对象材质是否正确。
3. **使用对比明显的颜色**：对于黑白棋子，使用接近纯黑和纯白的颜色值。
4. **调整光照和环境**：确保场景光照能够正确显示材质差异。

## 常见问题

### Q: 修改材质后无效怎么办？
A: 尝试强制更新视图层（`bpy.context.view_layer.update()`）并重新渲染场景。

### Q: 合并对象后材质消失？
A: 在合并对象后，确认目标对象的材质，如果丢失，需要重新应用材质。

### Q: 渲染结果颜色不正确？
A: 检查场景光照设置，确保有足够的环境光来显示材质差异。 